<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Morning Fat Loss</title>
  <meta name="description" content="A calm, nature‑themed habit tracker for workouts, dosing, water, and nutrition." />
  <meta name="theme-color" content="#5a7f71" media="(prefers-color-scheme: light)">
  <meta name="theme-color" content="#0d1b16" media="(prefers-color-scheme: dark)">
  <link rel="manifest" href="manifest.webmanifest">
  <link rel="icon" href="assets/icons/icon-192.png" sizes="192x192">
  <link rel="apple-touch-icon" href="assets/icons/icon-192.png">
  <style>
    :root{
      --bg:#f4f7f5; --card:#e7efe9; --accent:#5a7f71; --drop:#a8c8ba;
      --ink:#22302a; --muted:#5b6b64; --white:#fff; --success:#4ade80; --warning:#f59e0b;
      --shadow: 0 1px 0 rgba(0,0,0,.03);
      --safe-bottom: env(safe-area-inset-bottom);
    }
    @media (prefers-color-scheme: dark){
      :root{
        --bg:#0e1512; --card:#12211b; --accent:#8bd0b1; --drop:#3a6d5b;
        --ink:#ebf3f0; --muted:#a6bbb1; --white:#0e1512; --shadow: 0 1px 0 rgba(0,0,0,.2);
      }
      .tabbar{background:#0b100e;border-top-color:#1b2a24}
      .card,.timeline li{border-color:#1b2a24}
      .progress-bar{background:#1b2a24}
    }
    *{box-sizing:border-box} html,body{height:100%}
    body{margin:0;font-family:system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;color:var(--ink);background:var(--bg)}
    .app-header{position:sticky; top:0; z-index:100; display:flex; justify-content:space-between; align-items:center; gap:8px; padding:14px 16px; background:linear-gradient(180deg, var(--card), color-mix(in oklab, var(--card) 70%, transparent)); border-bottom:1px solid color-mix(in oklab, black 6%, transparent)}
    h1{margin:0; font-size:1.1rem}
    .muted{color:var(--muted)}
    .btn{background:none;border:1px solid color-mix(in oklab, black 8%, transparent); padding:8px 12px; border-radius:10px; color:var(--ink)}
    .btn.primary{background:var(--accent); border-color:var(--accent); color:#fff}
    .btn.ghost{border:none; color:var(--accent); font-weight:700; background:transparent}
    .btn:focus-visible{outline:2px solid color-mix(in oklab, var(--accent) 70%, white); outline-offset:2px}
    .view{display:none; padding:12px 12px calc(84px + var(--safe-bottom))} .view.active{display:block}
    .day-header{display:flex; justify-content:space-between; align-items:center; margin:8px 4px 12px}
    .day-cluster{display:flex; flex-direction:column; gap:4px}
    .day-name{font-size:1.1rem; font-weight:800; color:var(--accent)} .day-type{font-size:.92rem; color:var(--muted)} .streak{font-size:.9rem; color:var(--accent); font-weight:700}
    .picker{display:flex; gap:6px; flex-wrap:wrap}
    .chip{padding:6px 10px; border-radius:999px; border:1px solid color-mix(in oklab, black 8%, transparent); background:var(--card); font-size:.85rem; cursor:pointer}
    .chip[aria-pressed="true"]{background:var(--accent); color:#fff; border-color:var(--accent)} .today-chip{box-shadow:0 0 0 2px color-mix(in oklab, var(--accent) 50%, white)}
    .timeline{list-style:none; padding:0; margin:0}
    .card, .timeline li{background:var(--card); border:1px solid color-mix(in oklab, black 8%, transparent); border-radius:14px; padding:14px; margin:10px 4px; box-shadow:var(--shadow)}
    .task{display:grid; grid-template-columns: 28px 1fr; align-items:start; gap:12px} .task input[type="checkbox"]{width:22px;height:22px; accent-color:var(--accent); margin-top:2px}
    .task label{display:block} .task-time{font-weight:800; color:var(--accent); font-size:.95rem; margin-bottom:2px} .task-title{font-weight:700; margin-bottom:2px} .task-note{color:var(--muted); font-size:.9rem; line-height:1.4}
    .task-details{margin-top:8px; padding-top:8px; border-top:1px solid color-mix(in oklab, black 10%, transparent)} .workout-details{background:color-mix(in oklab, var(--accent) 12%, transparent); padding:10px; border-radius:8px}
    .water{margin:18px 4px} .water-head{display:flex; justify-content:space-between; align-items:center; margin-bottom:8px} .drops{display:flex; gap:6px; flex-wrap:wrap}
    .drop{width:24px; height:32px; border-radius:12px; background:color-mix(in oklab, var(--accent) 15%, transparent); border:1px solid color-mix(in oklab, black 8%, transparent); cursor:pointer; position:relative; transition:transform .15s ease}
    .drop.filled{background:var(--drop); transform:scale(1.05)} .drop::after{content:""; position:absolute; top:6px; left:8px; width:8px; height:8px; border-radius:50%; background:rgba(255,255,255,.9)}
    .progress-bar{width:100%; height:8px; background:#dfe9e3; border-radius:6px; overflow:hidden; margin-top:6px} .progress-fill{height:100%; width:0; background:linear-gradient(90deg, var(--accent), var(--success)); transition:width .25s ease}
    @media (prefers-reduced-motion: reduce){ .drop{transition:none} .progress-fill{transition:none} }
    .stats-grid{display:grid; grid-template-columns:repeat(2,1fr); gap:12px; margin:10px 4px} .stat-card{text-align:center} .stat-number{font-size:1.4rem; font-weight:800; color:var(--accent)}
    .tabbar{position:fixed; inset-inline:0; bottom:0; z-index:101; display:flex; background:#fff; border-top:1px solid color-mix(in oklab, black 8%, transparent); padding-bottom:var(--safe-bottom)}
    @media (prefers-color-scheme: dark){ .tabbar{background:#0b100e} }
    .tabbar button{flex:1; padding:12px 8px; background:none; border:none; color:var(--muted); font-weight:700; font-size:.85rem} .tabbar button.active{color:var(--accent)}
    dialog{border:none; border-radius:14px; overflow:hidden} dialog form{padding:16px} #timeForm .row{display:grid; grid-template-columns: 1fr 120px; gap:8px; margin:6px 0}
    .today-highlight{outline:2px solid color-mix(in oklab, var(--accent) 60%, white); border-radius:12px; box-shadow:0 0 0 4px color-mix(in oklab, var(--accent) 12%, transparent) inset}

    /* Resources table */
    .resource-section{margin:12px 4px}
    .table{display:grid; gap:6px} .row{display:grid; grid-template-columns: 110px 1fr 90px 140px 1fr; gap:6px}
    .row div{background:var(--card); border:1px solid color-mix(in oklab, black 8%, transparent); border-radius:10px; padding:10px; text-align:center} .row.head div{font-weight:800}
    @media (max-width: 480px){ .row{grid-template-columns: 90px 1fr;} .row div:nth-child(n+3){display:none} }

    /* Log form */
    .form{display:grid; gap:10px; margin:8px 4px}
    .field{display:grid; grid-template-columns: 1fr 120px; align-items:center; gap:8px; background:var(--card); border:1px solid color-mix(in oklab, black 8%, transparent); border-radius:12px; padding:10px}
    .field input{width:100%; padding:8px; border-radius:8px; border:1px solid color-mix(in oklab, black 10%, transparent); background:var(--white); color:var(--ink)}
    .field small{color:var(--muted)}
    .form h3{margin:6px 4px}
    .grid-2{display:grid; grid-template-columns: 1fr 1fr; gap:10px}
    .badge{display:inline-block; padding:3px 8px; border-radius:999px; background:var(--card); border:1px solid color-mix(in oklab, black 8%, transparent); color:var(--muted); font-size:.8rem}
    .pill{display:inline-block; padding:4px 8px; border-radius:999px; background:color-mix(in oklab, var(--accent) 15%, transparent); color:var(--accent); font-weight:700; font-size:.8rem}
    .section-title{display:flex; justify-content:space-between; align-items:center; gap:8px; margin:10px 4px}
    canvas{width:100%; height:200px; background:var(--card); border:1px solid color-mix(in oklab, black 8%, transparent); border-radius:12px}
  </style>
</head>
<body>
  <header class="app-header" role="banner">
    <h1>Morning Fat Loss</h1>
    <div class="picker" role="tablist" aria-label="Pick a day to preview">
      <button class="chip" data-day="0" aria-pressed="false" aria-label="Sunday">Sun</button>
      <button class="chip" data-day="1" aria-pressed="false" aria-label="Monday">Mon</button>
      <button class="chip" data-day="2" aria-pressed="false" aria-label="Tuesday">Tue</button>
      <button class="chip" data-day="3" aria-pressed="false" aria-label="Wednesday">Wed</button>
      <button class="chip" data-day="4" aria-pressed="false" aria-label="Thursday">Thu</button>
      <button class="chip" data-day="5" aria-pressed="false" aria-label="Friday">Fri</button>
      <button class="chip" data-day="6" aria-pressed="false" aria-label="Saturday">Sat</button>
    </div>
  </header>

  <!-- Today View -->
  <main id="view-today" class="view active" role="main">
    <div class="day-header" aria-live="polite">
      <div class="day-cluster">
        <div class="day-name" id="dayName">Monday</div>
        <div class="day-type" id="dayType">Full Body Strength • Dose day</div>
        <div class="muted" id="weekLabel">Week 1</div>
      </div>
      <div class="streak" aria-label="Current streak"><span aria-hidden="true">🔥</span> <span id="streakCount">0</span> day streak</div>
    </div>

    <ul id="timeline" class="timeline" aria-label="Today timeline"></ul>

    <section class="water" aria-labelledby="waterHeading">
      <div class="water-head">
        <h2 id="waterHeading">Hydration</h2>
        <div class="muted"><span id="waterCurrent" aria-live="polite">0</span>/8 glasses</div>
      </div>
      <div id="waterDrops" class="drops" role="group" aria-label="Water cups"></div>
      <div class="progress-bar" aria-hidden="true"><div id="waterProgress" class="progress-fill"></div></div>
    </section>
  </main>

  <!-- Week View -->
  <main id="view-week" class="view">
    <div class="stats-grid" aria-label="Weekly stats">
      <div class="card stat-card"><div class="stat-number" id="weekCompleted">0</div><div class="muted">Days Completed</div></div>
      <div class="card stat-card"><div class="stat-number" id="weekPercentage">0%</div><div class="muted">Week Progress</div></div>
    </div>
    <div id="weekOverview" class="timeline"></div>
    <div class="card">
      <h2>Weekly Schedule</h2>
      <div id="weekSchedule"></div>
    </div>
    <button id="resetWeekBtn" class="btn" style="margin:12px 4px">Reset Week</button>
  </main>

  <!-- Resources -->
  <main id="view-resources" class="view">
    <section class="card resource-section">
      <h2>SECTION 1 – 4-Week Morning Fat Loss Calendar</h2>
      <p>You’ll have check boxes for: Dose ✔, Workout ✔, Cardio ✔, Nutrition ✔ each day.</p>
      <p><strong>Legend:</strong> 🏋 Strength • ⚡ HIIT • 🚶 Active Recovery • ❌ Rest</p>
      <div class="table">
        <div class="row head"><div>Day</div><div>Training</div><div>Sermorelin</div><div>Cardio</div><div>Nutrition Focus</div></div>
        <div class="row"><div>Mon 🏋</div><div>Full Body Strength</div><div>✔</div><div>—</div><div>Mod carbs post‑workout</div></div>
        <div class="row"><div>Tue ⚡</div><div>HIIT + Core</div><div>✔</div><div>—</div><div>Low carb PM</div></div>
        <div class="row"><div>Wed 🏋</div><div>Upper Strength + Cardio</div><div>✔</div><div>20 min steady</div><div>Mod carbs post‑workout</div></div>
        <div class="row"><div>Thu ⚡</div><div>HIIT</div><div>✔</div><div>—</div><div>Low carb PM</div></div>
        <div class="row"><div>Fri 🏋</div><div>Lower Strength + Cardio</div><div>✔</div><div>20–30 min steady</div><div>Mod carbs post‑workout</div></div>
        <div class="row"><div>Sat 🚶</div><div>Active Recovery</div><div>❌</div><div>Fasted walk</div><div>Low carb day</div></div>
        <div class="row"><div>Sun ❌</div><div>Rest</div><div>❌</div><div>Light walk optional</div><div>Low carb day</div></div>
      </div>
    </section>

    <section class="card resource-section">
      <h2>SECTION 2 – Detailed Workouts (With Alternatives)</h2>
      <h3>MONDAY – Full Body Strength</h3>
      <p><em>Main Routine (3 sets each, 8–12 reps, 60–90 sec rest)</em></p>
      <ul>
        <li>Barbell Back Squat → alt: Dumbbell Goblet Squat</li>
        <li>Bench Press → alt: Dumbbell Chest Press</li>
        <li>Bent-Over Barbell Row → alt: One-Arm Dumbbell Row</li>
        <li>Seated Overhead Press → alt: Arnold Press</li>
        <li>Romanian Deadlift → alt: Kettlebell Deadlift</li>
        <li>Plank (3×30–60 sec) → alt: Dead Bug</li>
      </ul>

      <h3>TUESDAY – HIIT + Core</h3>
      <p><em>HIIT (15–20 min)</em></p>
      <ul>
        <li>20 sec all-out sprint (bike/treadmill/rower) → 40 sec rest × 8–10</li>
      </ul>
      <p><em>Core Finisher (3 rounds)</em></p>
      <ul>
        <li>Hanging Knee Raises × 12 → alt: Lying Leg Raise</li>
        <li>Russian Twists × 20 (10/side) → alt: Cable Woodchop</li>
        <li>Side Plank × 30 sec/side</li>
      </ul>

      <h3>WEDNESDAY – Upper Strength + Cardio</h3>
      <p><em>Strength (3×8–12)</em></p>
      <ul>
        <li>Pull-Ups or Assisted Pull-Up → alt: Lat Pulldown</li>
        <li>Incline Dumbbell Press → alt: Barbell Incline Press</li>
        <li>Barbell Row → alt: Single-Arm Row</li>
        <li>Dumbbell Lateral Raise → alt: Cable Lateral Raise</li>
        <li>Tricep Dips → alt: Cable Rope Pushdown</li>
        <li>Bicep Curl → alt: Hammer Curl</li>
      </ul>
      <p><em>Cardio – 20 min steady pace after lifting</em></p>

      <h3>THURSDAY – HIIT</h3>
      <ul>
        <li>30 sec high-intensity battle ropes → 30 sec rest × 10 rounds</li>
        <li><strong>or</strong> Sprint Intervals: 15 sec all-out / 45 sec walk × 10 rounds</li>
      </ul>

      <h3>FRIDAY – Lower Strength + Cardio</h3>
      <p><em>Strength (3×8–12)</em></p>
      <ul>
        <li>Deadlift → alt: Trap Bar Deadlift</li>
        <li>Walking Lunges (per leg) → alt: Step-Ups</li>
        <li>Hip Thrusts → alt: Glute Bridge</li>
        <li>Bulgarian Split Squat → alt: Goblet Squat</li>
        <li>Standing Calf Raise → alt: Seated Calf Raise</li>
      </ul>
      <p><em>Cardio – 20–30 min steady pace after lifting</em></p>

      <h3>SATURDAY – Active Recovery</h3>
      <ul>
        <li>20–30 min fasted walk or yoga/stretching</li>
        <li>Focus on mobility and recovery</li>
      </ul>
    </section>

    <section class="card resource-section">
      <h2>SECTION 3 – Nutrition & Snack Options</h2>
      <h3>Protein Snack Options</h3>
      <ul>
        <li>Whey isolate (110–130 cal, 25g protein) with water or unsweetened almond milk</li>
        <li>Greek yogurt (150g, 100 cal, 18g protein) + cinnamon</li>
        <li>Cottage cheese (½ cup, 90 cal, 14g protein) with berries</li>
        <li>Turkey or chicken slices with mustard</li>
        <li>Hard-boiled eggs (add hot sauce or spices)</li>
        <li>Protein bars (aim for 18–22g protein, &lt;8g sugar)</li>
      </ul>

      <h3>Breakfast Ideas (post‑workout small carbs)</h3>
      <ul>
        <li>2 eggs + 3 egg whites + ½ banana</li>
        <li>Protein shake + small handful of berries</li>
        <li>Greek yogurt + chia seeds + blueberries</li>
      </ul>

      <h3>Lunch Ideas (moderate carbs)</h3>
      <ul>
        <li>Chicken breast + quinoa + roasted veggies</li>
        <li>Salmon + sweet potato + spinach</li>
        <li>Lean ground turkey + brown rice + broccoli</li>
      </ul>

      <h3>Dinner Ideas (low carb, protein + fats)</h3>
      <ul>
        <li>Grilled chicken + asparagus + olive oil</li>
        <li>White fish + zucchini noodles + pesto</li>
        <li>Lean steak + roasted Brussels sprouts</li>
      </ul>
    </section>
  </main>

  <!-- Log -->
  <main id="view-log" class="view">
    <div class="section-title">
      <h2>Daily Log</h2>
      <button id="saveLogBtn" class="btn primary">Save</button>
    </div>
    <div class="form" aria-label="Daily measurements and habits">
      <div class="grid-2">
        <div class="field"><label for="logDate">Date</label><input id="logDate" type="date"></div>
        <div class="field"><label for="logWeight">Weight (lb)</label><input id="logWeight" type="number" step="0.1" inputmode="decimal"></div>
      </div>
      <div class="grid-2">
        <div class="field"><label for="logWaist">Waist (in)</label><input id="logWaist" type="number" step="0.1" inputmode="decimal"></div>
        <div class="field"><label for="logHips">Hips (in)</label><input id="logHips" type="number" step="0.1" inputmode="decimal"></div>
      </div>
      <div class="grid-2">
        <div class="field"><label for="logChest">Bust/Chest (in)</label><input id="logChest" type="number" step="0.1" inputmode="decimal"></div>
        <div class="field"><label for="logThigh">Thigh (in)</label><input id="logThigh" type="number" step="0.1" inputmode="decimal"></div>
      </div>
      <div class="grid-2">
        <div class="field"><label for="logArm">Arm (in)</label><input id="logArm" type="number" step="0.1" inputmode="decimal"></div>
        <div class="field"><label for="logProtein">Protein (g)</label><input id="logProtein" type="number" step="1" inputmode="numeric"></div>
      </div>
      <div class="grid-2">
        <div class="field"><label for="logSleep">Sleep (hrs)</label><input id="logSleep" type="number" step="0.1" inputmode="decimal"></div>
        <div class="field"><label for="logSteps">Steps</label><input id="logSteps" type="number" step="1" inputmode="numeric"></div>
      </div>
      <div class="field"><label for="logMood">Mood / Energy (1–5)</label><input id="logMood" type="number" min="1" max="5" step="1" inputmode="numeric"></div>

      <h3>Strength (top sets)</h3>
      <div class="grid-2">
        <div class="field"><label for="squat">Squat (lb × reps)</label><input id="squat" placeholder="e.g., 165x8"></div>
        <div class="field"><label for="bench">Bench (lb × reps)</label><input id="bench" placeholder="e.g., 95x10"></div>
      </div>
      <div class="grid-2">
        <div class="field"><label for="row">Row (lb × reps)</label><input id="row" placeholder="e.g., 95x10"></div>
        <div class="field"><label for="ohp">Overhead Press (lb × reps)</label><input id="ohp" placeholder="e.g., 65x8"></div>
      </div>
      <div class="grid-2">
        <div class="field"><label for="rdl">RDL / Deadlift (lb × reps)</label><input id="rdl" placeholder="e.g., 185x6"></div>
        <div class="field"><label for="hip">Hip Thrust (lb × reps)</label><input id="hip" placeholder="e.g., 185x10"></div>
      </div>
    </div>

    <div class="section-title">
      <h2>Backup</h2>
      <div>
        <button id="exportBtn" class="btn">Export</button>
        <label class="btn" style="cursor:pointer">
          Import <input id="importInput" type="file" accept="application/json" style="display:none">
        </label>
      </div>
    </div>
    <p class="muted" style="margin:0 4px 8px">Export creates a JSON backup of all your app data (schedule, checks, logs). Import restores it.</p>
  </main>

  <!-- Progress -->
  <main id="view-progress" class="view">
    <div class="section-title">
      <h2>Progress</h2>
      <span id="progressBadges"></span>
    </div>

    <div class="card">
      <h3 style="margin:0 0 8px">Weight Trend</h3>
      <canvas id="chartWeight" width="400" height="220" aria-label="Weight chart"></canvas>
      <div class="muted" style="margin-top:6px"><span class="badge" id="weightChange">—</span></div>
    </div>

    <div class="card">
      <h3 style="margin:0 0 8px">Waist Trend</h3>
      <canvas id="chartWaist" width="400" height="220" aria-label="Waist chart"></canvas>
      <div class="muted" style="margin-top:6px"><span class="badge" id="waistChange">—</span></div>
    </div>

    <div class="card">
      <h3 style="margin:0 0 8px">Weekly Summary</h3>
      <div class="grid-2">
        <div><div class="pill" id="sumWorkouts">—</div><small class="muted">Workouts completed</small></div>
        <div><div class="pill" id="sumProtein">—</div><small class="muted">Avg protein/day</small></div>
        <div><div class="pill" id="sumSleep">—</div><small class="muted">Avg sleep (hrs)</small></div>
        <div><div class="pill" id="sumWater">—</div><small class="muted">Avg water (glasses)</small></div>
      </div>
    </div>
  </main>

  <nav class="tabbar" role="navigation" aria-label="App tabs">
    <button data-target="view-today" class="active" aria-controls="view-today" aria-selected="true">Today</button>
    <button data-target="view-week" aria-controls="view-week" aria-selected="false">Week</button>
    <button data-target="view-resources" aria-controls="view-resources" aria-selected="false">Resources</button>
    <button data-target="view-log" aria-controls="view-log" aria-selected="false">Log</button>
    <button data-target="view-progress" aria-controls="view-progress" aria-selected="false">Progress</button>
  </nav>

  <script>
    const WEEKLY_SCHEDULE = {
      0:{type:"Rest Day",workoutType:"rest",dose:false,schedule:[
        {key:"hydrate",time:"08:00",title:"Wake & Hydrate",note:"16–20 oz water"},
        {key:"activity",time:"09:00",title:"Light Activity",note:"Light mobility or leisure activity"},
        {key:"breakfast",time:"09:30",title:"Breakfast",note:"Protein + fats"},
        {key:"lunch",time:"12:30",title:"Lunch",note:"Protein + greens (low carb)"},
        {key:"dinner",time:"18:00",title:"Dinner",note:"Protein + veggies (low carb)"},
        {key:"sleep",time:"22:00",title:"Wind Down",note:"No food 2 hrs before bed"}
      ]},
      1:{type:"Full Body Strength",workoutType:"strength",dose:true,schedule:[
        {key:"hydrate",time:"06:15",title:"Wake & Hydrate",note:"16–20 oz water"},
        {key:"workout",time:"06:30",title:"Full Body Workout",note:"45–60 min strength",details:"Barbell Back Squat → alt: Goblet Squat; Bench Press → alt: DB Chest; Bent‑Over Row → alt: 1‑Arm DB Row; Seated OHP → alt: Arnold Press; RDL → alt: Kettlebell Deadlift; Plank 3×30–60s → alt: Dead Bug"},
        {key:"postwo",time:"07:45",title:"Post‑Workout",note:"25–30g protein + small carbs (banana/berries)"},
        {key:"snack1",time:"10:30",title:"Snack",note:"Protein + fats (turkey + avocado)"},
        {key:"lunch",time:"13:00",title:"Lunch",note:"Lean protein + moderate carbs + veggies"},
        {key:"snack2",time:"16:30",title:"Snack",note:"Protein + veggies or nuts"},
        {key:"dinner",time:"19:00",title:"Dinner",note:"Protein + low‑carb veggies + healthy fats"},
        {key:"cutoff",time:"21:45",title:"Food Cutoff",note:"No food after this time"},
        {key:"dose",time:"22:30",title:"Sermorelin 40 mg",note:""},
        {key:"sleep",time:"22:35",title:"Sleep",note:""}
      ]},
      2:{type:"HIIT + Core",workoutType:"hiit",dose:true,schedule:[
        {key:"hydrate",time:"06:15",title:"Wake & Hydrate",note:"16–20 oz water"},
        {key:"workout",time:"06:30",title:"HIIT + Core",note:"15–20 min HIIT + core",details:"Sprints 20s all‑out / 40s rest × 8–10 • Core: Knee Raises ×12, Russian Twists ×20, Side Plank ×30s/side"},
        {key:"postwo",time:"06:55",title:"Post‑Workout",note:"Protein + small carbs"},
        {key:"snack1",time:"10:00",title:"Snack",note:"Protein + fats"},
        {key:"lunch",time:"13:00",title:"Lunch",note:"Lean protein + moderate carbs"},
        {key:"snack2",time:"16:00",title:"Snack",note:"Protein + veggies"},
        {key:"dinner",time:"19:00",title:"Dinner",note:"Protein + greens + olive oil"},
        {key:"cutoff",time:"21:45",title:"Food Cutoff",note:"No food after this time"},
        {key:"dose",time:"22:30",title:"Sermorelin 40 mg",note:""}
      ]},
      3:{type:"Upper Strength + Cardio",workoutType:"strength",dose:true,schedule:[
        {key:"hydrate",time:"06:15",title:"Wake & Hydrate",note:"16–20 oz water"},
        {key:"workout",time:"06:30",title:"Upper + 20m Cardio",note:"45 min upper + 20 min steady",details:"Pull‑Ups → alt: Lat Pulldown; Incline DB Press → alt: Barbell Incline; Barbell Row → alt: Single‑Arm Row; DB Laterals → alt: Cable Laterals; Dips → alt: Rope Pushdown; Curls → alt: Hammer Curl"},
        {key:"postwo",time:"07:45",title:"Post‑Workout",note:"Protein + moderate carbs"},
        {key:"snack1",time:"10:30",title:"Snack",note:"Protein + fats"},
        {key:"lunch",time:"13:00",title:"Lunch",note:"Lean protein + moderate carbs"},
        {key:"snack2",time:"16:30",title:"Snack",note:"Protein + veggies"},
        {key:"dinner",time:"19:00",title:"Dinner",note:"Protein + low‑carb veggies + fats"},
        {key:"cutoff",time:"21:45",title:"Food Cutoff",note:"No food after this time"},
        {key:"dose",time:"22:30",title:"Sermorelin 40 mg",note:""}
      ]},
      4:{type:"HIIT",workoutType:"hiit",dose:true,schedule:[
        {key:"hydrate",time:"06:15",title:"Wake & Hydrate",note:"16–20 oz water"},
        {key:"workout",time:"06:30",title:"HIIT Training",note:"15 min high intensity",details:"Battle ropes 30s on / 30s off × 10 or Sprints 15s all‑out / 45s walk × 10"},
        {key:"postwo",time:"06:50",title:"Post‑Workout",note:"Protein + small carbs"},
        {key:"snack1",time:"10:00",title:"Snack",note:"Protein + fats"},
        {key:"lunch",time:"13:00",title:"Lunch",note:"Lean protein + moderate carbs"},
        {key:"snack2",time:"16:00",title:"Snack",note:"Protein + veggies"},
        {key:"dinner",time:"19:00",title:"Dinner",note:"Protein + greens + olive oil"},
        {key:"cutoff",time:"21:45",title:"Food Cutoff",note:"No food after this time"},
        {key:"dose",time:"22:30",title:"Sermorelin 40 mg",note:""}
      ]},
      5:{type:"Lower Strength + Cardio",workoutType:"strength",dose:true,schedule:[
        {key:"hydrate",time:"06:15",title:"Wake & Hydrate",note:"16–20 oz water"},
        {key:"workout",time:"06:30",title:"Lower + 20–30m Cardio",note:"45 min lower + 20–30 min steady",details:"Deadlift → alt: Trap Bar; Walking Lunges → alt: Step‑Ups; Hip Thrust → alt: Glute Bridge; Bulgarian Split Squat → alt: Goblet Squat; Standing Calf Raise → alt: Seated Calf Raise"},
        {key:"postwo",time:"07:45",title:"Post‑Workout",note:"Protein + moderate carbs"},
        {key:"snack1",time:"10:30",title:"Snack",note:"Protein + fats"},
        {key:"lunch",time:"13:00",title:"Lunch",note:"Lean protein + moderate carbs"},
        {key:"snack2",time:"16:30",title:"Snack",note:"Protein + veggies"},
        {key:"dinner",time:"19:00",title:"Dinner",note:"Protein + low‑carb veggies + fats"},
        {key:"cutoff",time:"21:45",title:"Food Cutoff",note:"No food after this time"},
        {key:"dose",time:"22:30",title:"Sermorelin 40 mg",note:""}
      ]},
      6:{type:"Active Recovery",workoutType:"recovery",dose:false,schedule:[
        {key:"hydrate",time:"07:00",title:"Wake & Hydrate",note:"16–20 oz water"},
        {key:"activity",time:"07:30",title:"Fasted Walk / Yoga",note:"20–30 min light activity"},
        {key:"breakfast",time:"09:00",title:"Breakfast",note:"Protein + fats (low carb)"},
        {key:"lunch",time:"12:30",title:"Lunch",note:"Protein + greens (low carb)"},
        {key:"dinner",time:"18:00",title:"Dinner",note:"Protein + veggies (low carb)"},
        {key:"sleep",time:"22:00",title:"Wind Down",note:"No food 2 hrs before bed"}
      ]}
    };
    const ICONS={strength:"🏋️",hiit:"⚡",recovery:"🚶",rest:"😴"}; const DAY_NAMES=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];

    // ---- State helpers ----
    function loadState(){ try{return JSON.parse(localStorage.getItem("mfl_state_v23b")||"{}")}catch(e){return {}}}
    function saveState(s){ localStorage.setItem("mfl_state_v23b", JSON.stringify(s)) }
    function todayKey(){ return new Date().toISOString().slice(0,10) }
    function getDow(){ return Number(document.querySelector('.chip[aria-pressed="true"]')?.dataset.day ?? new Date().getDay()) }
    function toHuman(hm){ if(!hm||hm.includes(':')===false) return hm; const [h,m]=hm.split(':').map(Number); const d=new Date(); d.setHours(h); d.setMinutes(m); return d.toLocaleTimeString([], {hour:'numeric',minute:'2-digit'}) }

    function initDefaults(){
      const s=loadState();
      if(!s.waterGoal) s.waterGoal=8;
      if(!s.water) s.water={};
      if(!s.checks) s.checks={}; // dateKey -> { itemKey: true }
      if(!s.streak) s.streak=0;
      if(!s.weekStart){
        const t=new Date(); const mon=new Date(t); const dow=mon.getDay(); const diff=(dow===0?-6:1)-dow; mon.setDate(t.getDate()+diff); s.weekStart=mon.toISOString().slice(0,10);
      }
      if(!s.logs) s.logs={};
      if(!s.prs) s.prs={};
      saveState(s);
    }

    // ---- Rendering Today ----
    function renderHeader(){
      const dow=getDow(); const meta=WEEKLY_SCHEDULE[dow];
      document.getElementById('dayName').textContent=DAY_NAMES[dow];
      document.getElementById('dayType').textContent = `${ICONS[meta.workoutType]} ${meta.type} • ${meta.dose ? 'Dose day' : 'No dose'}`;
      const s=loadState(); document.getElementById('streakCount').textContent = s.streak||0;
      const start=new Date(s.weekStart); const diffDays = Math.floor((Date.now()-start.getTime())/86400000);
      const weekNum = Math.floor(diffDays/7)+1; document.getElementById('weekLabel').textContent = `Week ${Math.max(1, weekNum)}`;
    }

    function renderTimeline(){
      const timeline=document.getElementById('timeline'); timeline.innerHTML='';
      const s=loadState(); const dk=todayKey(); const checks=s.checks[dk]||{}; const dow=getDow(); const plan=WEEKLY_SCHEDULE[dow].schedule;
      plan.forEach(item=>{
        const li=document.createElement('li'); const div=document.createElement('div'); div.className='task';
        const id=`${dow}-${item.key}`; const cb=document.createElement('input'); cb.type='checkbox'; cb.id=id; cb.checked=!!checks[id];
        cb.addEventListener('change',()=>{ const st=loadState(); st.checks[dk]=st.checks[dk]||{}; st.checks[dk][id]=cb.checked; saveState(st); updateProgress(); renderWeek(); });
        const lbl=document.createElement('label'); lbl.setAttribute('for', id);
        lbl.innerHTML = `<div class="task-time">${toHuman(item.time)}</div><div class="task-title">${item.title}</div><div class="task-note">${item.note||''}</div>${item.details?`<div class="task-details"><div class="workout-details"><strong>Workout Details:</strong><br>${item.details}</div></div>`:''}`;
        div.append(cb,lbl); li.append(div); timeline.append(li);
      });
    }

    function renderWater(){
      const s=loadState(); const dk=todayKey(); const cur=s.water[dk]||0; document.getElementById('waterCurrent').textContent=cur;
      const wrap=document.getElementById('waterDrops'); wrap.innerHTML='';
      for(let i=0;i<s.waterGoal;i++){ const b=document.createElement('button'); b.type='button'; b.className='drop'+(i<cur?' filled':''); b.addEventListener('click',()=>{ const st=loadState(); const c=st.water[dk]||0; st.water[dk]=(i<c)?i:i+1; saveState(st); renderWater(); updateProgress(); }); wrap.append(b); }
      document.getElementById('waterProgress').style.width = ((cur/s.waterGoal)*100).toFixed(0)+'%';
    }

    function renderWeek(){
      const s=loadState(); const weekOverview=document.getElementById('weekOverview'); weekOverview.innerHTML=''; const weekSchedule=document.getElementById('weekSchedule'); weekSchedule.innerHTML='';
      const start=new Date(s.weekStart); let doneDays=0;
      for(let i=0;i<7;i++){
        const d=new Date(start); d.setDate(start.getDate()+i); const dateKey=d.toISOString().slice(0,10); const dow=d.getDay();
        const plan=WEEKLY_SCHEDULE[dow]; const checks=s.checks[dateKey]||{}; const completed=Object.values(checks).filter(Boolean).length; const total=plan.schedule.length; const water=(s.water[dateKey]||0)/(s.waterGoal||8);
        const pct = Math.min(1, (total?completed/total:0)*0.8 + water*0.2);
        const row=document.createElement('li'); row.className='card'; if(new Date().toDateString()===d.toDateString()){ row.classList.add('today-highlight'); }
        row.innerHTML = `<div style="display:flex;justify-content:space-between;align-items:center;gap:8px"><div><strong>${DAY_NAMES[dow]}</strong> • ${ICONS[plan.workoutType]} ${plan.type} • ${plan.dose?'Dose':'No dose'}</div><div style="min-width:46px;text-align:right"><strong>${Math.round(pct*100)}%</strong></div></div><div class="progress-bar"><div class="progress-fill" style="width:${(pct*100).toFixed(0)}%"></div></div>`;
        weekOverview.append(row);
        const sched=document.createElement('div'); sched.className='card'; if(new Date().toDateString()===d.toDateString()){ sched.classList.add('today-highlight'); }
        sched.innerHTML=`<h3 style="margin:0 0 6px">${DAY_NAMES[dow]} – ${plan.type}</h3>`;
        plan.schedule.forEach(item=>{ const line=document.createElement('div'); line.className='muted'; line.style.margin='2px 0'; line.textContent = `${toHuman(item.time)} • ${item.title}`; sched.append(line); });
        weekSchedule.append(sched);
        if(pct>=0.9) doneDays++;
      }
      const pctWeek = Math.round((doneDays/7)*100); document.getElementById('weekCompleted').textContent=doneDays; document.getElementById('weekPercentage').textContent=pctWeek+'%';
    }

    function updateProgress(){
      const s=loadState(); const dk=todayKey(); const dow=getDow(); const plan=WEEKLY_SCHEDULE[dow];
      const checks=s.checks[dk]||{}; const completed=Object.values(checks).filter(Boolean).length; const total=plan.schedule.length; const water=(s.water[dk]||0)/(s.waterGoal||8);
      const pct=Math.min(1, (total?completed/total:0)*0.8 + water*0.2);
      if(pct>=0.9 && !s._markedToday){ s._markedToday=true; s.streak=(s.streak||0)+1; saveState(s); document.getElementById('streakCount').textContent=s.streak; }
    }

    // ---- Log tab ----
    function pad(n){ return String(n).padStart(2,'0') }
    function todayISO(){ const d=new Date(); return `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}` }

    function loadLog(dateKey){
      const s=loadState(); const L=s.logs[dateKey]||{};
      const set=(id,v)=>{ const el=document.getElementById(id); if(el) el.value = (v ?? ''); };
      set('logDate', dateKey);
      set('logWeight', L.weight); set('logWaist', L.waist); set('logHips', L.hips); set('logChest', L.chest); set('logThigh', L.thigh); set('logArm', L.arm);
      set('logProtein', L.protein); set('logSleep', L.sleep); set('logSteps', L.steps); set('logMood', L.mood);
      const lifts=L.lifts||{}; ['squat','bench','row','ohp','rdl','hip'].forEach(k=>{ set(k, lifts[k]||''); });
    }

    function parseTopSet(s){ if(!s) return null; const m=String(s).toLowerCase().replace('×','x').match(/(\\d+)\\s*x\\s*(\\d+)/); if(!m) return null; return {w:parseFloat(m[1]), r:parseFloat(m[2])}; }
    function e1rm(w,r){ if(!w||!r) return 0; return w*(1+r/30); }
    function updatePRsFor(dateKey, L){
      const s=loadState(); s.prs=s.prs||{}; const lifts=L.lifts||{};
      for(const [name,val] of Object.entries(lifts)){
        const tr=parseTopSet(val); if(!tr) continue; const est=e1rm(tr.w,tr.r);
        if(!s.prs[name] || est > s.prs[name]){ s.prs[name]=est; }
      }
      saveState(s);
    }

    function saveLog(){
      const dateKey=document.getElementById('logDate').value || todayISO();
      const get=(id)=>{ const v=document.getElementById(id).value; return v===''?undefined:(isNaN(v)?v:parseFloat(v)); };
      const lifts={}; ['squat','bench','row','ohp','rdl','hip'].forEach(k=>{ const v=document.getElementById(k).value.trim(); if(v) lifts[k]=v; });
      const L={ weight:get('logWeight'), waist:get('logWaist'), hips:get('logHips'), chest:get('logChest'), thigh:get('logThigh'), arm:get('logArm'),
                protein:get('logProtein'), sleep:get('logSleep'), steps:get('logSteps'), mood:get('logMood'), lifts:lifts };
      const s=loadState(); s.logs[dateKey]=Object.assign({}, s.logs[dateKey]||{}, L); saveState(s); updatePRsFor(dateKey, L); alert('Saved ✔'); renderProgress();
    }

    function initLog(){
      const d=todayISO(); document.getElementById('logDate').value=d; loadLog(d);
      document.getElementById('logDate').addEventListener('change', e=>loadLog(e.target.value));
      document.getElementById('saveLogBtn').addEventListener('click', saveLog);
      document.getElementById('exportBtn').addEventListener('click', ()=>{
        const data = loadState();
        const blob = new Blob([JSON.stringify(data,null,2)], {type:'application/json'});
        const a = document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='morning-fat-loss-backup.json'; a.click();
        setTimeout(()=>URL.revokeObjectURL(a.href), 1000);
      });
      document.getElementById('importInput').addEventListener('change', (e)=>{
        const file=e.target.files[0]; if(!file) return;
        const reader=new FileReader(); reader.onload=()=>{ try{ localStorage.setItem('mfl_state_v23b', reader.result); alert('Imported ✔'); renderAll(); renderWeek(); renderProgress(); }catch(err){ alert('Import failed'); } }; reader.readAsText(file);
      });
    }

    // ---- Progress tab ----
    function drawLineChart(canvasId, points, color){
      const cv=document.getElementById(canvasId); if(!cv) return; const ctx=cv.getContext('2d'); const w=cv.width, h=cv.height;
      ctx.clearRect(0,0,w,h);
      ctx.strokeStyle='rgba(0,0,0,0.1)'; ctx.lineWidth=1;
      ctx.beginPath(); ctx.moveTo(32,8); ctx.lineTo(32,h-24); ctx.lineTo(w-8,h-24); ctx.stroke();
      if(points.length<2) return;
      const xs=points.map(p=>p.x), ys=points.map(p=>p.y);
      const minX=Math.min(...xs), maxX=Math.max(...xs), minY=Math.min(...ys), maxY=Math.max(...ys);
      const px=x=>32 + ( (x-minX) / Math.max(1,(maxX-minX)) ) * (w-40);
      const py=y=> (h-24) - ( (y-minY) / Math.max(1,(maxY-minY)) ) * (h-40);
      ctx.strokeStyle=color||'#5a7f71'; ctx.lineWidth=2; ctx.beginPath();
      points.forEach((p,i)=>{ const X=px(p.x), Y=py(p.y); if(i===0) ctx.moveTo(X,Y); else ctx.lineTo(X,Y); }); ctx.stroke();
      ctx.fillStyle=color||'#5a7f71'; points.forEach(p=>{ const X=px(p.x), Y=py(p.y); ctx.beginPath(); ctx.arc(X,Y,3,0,Math.PI*2); ctx.fill(); });
    }

    function daysSinceEpoch(iso){ return Math.floor(new Date(iso).getTime()/86400000); }
    function calcChange(arr){ if(arr.length<2) return '—'; const first=arr[0].y, last=arr[arr.length-1].y; const diff = last-first; const sign = diff>0?'+':''; return `${sign}${diff.toFixed(1)}`; }
    function getLogsSorted(){ const s=loadState(); const entries=Object.entries(s.logs||{}).sort((a,b)=>new Date(a[0])-new Date(b[0])); return entries; }

    function renderProgress(){
      const entries=getLogsSorted();
      const wPts = entries.filter(([d,L])=>L.weight!=null).map(([d,L])=>({x:daysSinceEpoch(d), y:Number(L.weight)}));
      drawLineChart('chartWeight', wPts, getComputedStyle(document.documentElement).getPropertyValue('--accent').trim());
      document.getElementById('weightChange').textContent = wPts.length?`Δ ${calcChange(wPts)} lb`:'—';
      const waistPts = entries.filter(([d,L])=>L.waist!=null).map(([d,L])=>({x:daysSinceEpoch(d), y:Number(L.waist)}));
      drawLineChart('chartWaist', waistPts, getComputedStyle(document.documentElement).getPropertyValue('--drop').trim());
      document.getElementById('waistChange').textContent = waistPts.length?`Δ ${calcChange(waistPts)} in`:'—';

      const s=loadState(); const start=new Date(s.weekStart); const end=new Date(start); end.setDate(start.getDate()+7);
      let workouts=0, protein=0, proteinDays=0, sleep=0, sleepDays=0, water=0, waterDays=0;
      for(let i=0;i<7;i++){
        const d=new Date(start); d.setDate(start.getDate()+i); const dk=d.toISOString().slice(0,10);
        const checks=s.checks[dk]||{}; const total=(Object.keys(checks).length||1); const done=(Object.values(checks).filter(Boolean).length)/(total);
        if(done>=0.6) workouts++;
        const L=s.logs[dk]; if(L){
          if(L.protein){ protein+=Number(L.protein); proteinDays++; }
          if(L.sleep){ sleep+=Number(L.sleep); sleepDays++; }
        }
        if(s.water[dk]!=null){ water+=Number(s.water[dk]); waterDays++; }
      }
      document.getElementById('sumWorkouts').textContent = `${workouts}/7`;
      document.getElementById('sumProtein').textContent = proteinDays? `${Math.round(protein/proteinDays)} g` : '—';
      document.getElementById('sumSleep').textContent = sleepDays? (sleep/sleepDays).toFixed(1)+' h' : '—';
      document.getElementById('sumWater').textContent = waterDays? (water/waterDays).toFixed(1)+' cups' : '—';

      const prs = loadState().prs||{}; const wrap=document.getElementById('progressBadges'); wrap.innerHTML='';
      Object.entries(prs).forEach(([lift,val])=>{ const b=document.createElement('span'); b.className='badge'; b.style.marginRight='6px'; b.textContent=`PR ${lift.toUpperCase()}: ${Math.round(val)} (est 1RM)`; wrap.append(b); });
    }

    // ---- Navigation ----
    document.querySelectorAll('.tabbar button').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        document.querySelectorAll('.tabbar button').forEach(b=>b.classList.remove('active'));
        btn.classList.add('active');
        document.querySelectorAll('.view').forEach(v=>v.classList.remove('active'));
        document.getElementById(btn.dataset.target).classList.add('active');
        window.scrollTo({top:0, behavior:'smooth'});
        if(btn.dataset.target==='view-week'){ renderWeek(); }
        if(btn.dataset.target==='view-progress'){ renderProgress(); }
        if(btn.dataset.target==='view-log'){ initLog(); }
      });
    });

    // Weekday picker
    document.querySelectorAll('.chip').forEach(chip=>{
      chip.addEventListener('click', ()=>{
        document.querySelectorAll('.chip').forEach(c=>c.setAttribute('aria-pressed','false'));
        chip.setAttribute('aria-pressed','true'); renderAll();
      });
    });

    function setPickerToToday(){
      const dow=new Date().getDay(); const chip=document.querySelector(`.chip[data-day="${dow}"]`);
      if(chip){ chip.setAttribute('aria-pressed','true'); chip.classList.add('today-chip'); }
    }

    function renderAll(){ renderHeader(); renderTimeline(); renderWater(); updateProgress(); }

    // Init
    initDefaults(); setPickerToToday(); renderAll(); renderWeek(); renderProgress();
    if('serviceWorker' in navigator){ navigator.serviceWorker.register('./service-worker.js').catch(()=>{}); }
  </script>
</body>
</html>
