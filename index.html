<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Morning Fat Loss</title>
  <meta name="description" content="A calm, nature‚Äëthemed habit tracker for workouts, dosing, water, and nutrition." />
  <meta name="theme-color" content="#5a7f71" media="(prefers-color-scheme: light)">
  <meta name="theme-color" content="#0d1b16" media="(prefers-color-scheme: dark)">
  <link rel="manifest" href="manifest.webmanifest">
  <link rel="icon" href="assets/icons/icon-192.png" sizes="192x192">
  <link rel="apple-touch-icon" href="assets/icons/icon-192.png">
  <style>
    :root{
      --bg:#f4f7f5; --card:#e7efe9; --accent:#5a7f71; --drop:#a8c8ba;
      --ink:#22302a; --muted:#5b6b64; --white:#fff; --success:#4ade80; --warning:#f59e0b;
      --shadow: 0 1px 0 rgba(0,0,0,.03);
      --safe-bottom: env(safe-area-inset-bottom);
    }
    @media (prefers-color-scheme: dark){
      :root{
        --bg:#0e1512; --card:#12211b; --accent:#8bd0b1; --drop:#3a6d5b;
        --ink:#ebf3f0; --muted:#a6bbb1; --white:#0e1512; --shadow: 0 1px 0 rgba(0,0,0,.2);
      }
      .tabbar{background:#0b100e;border-top-color:#1b2a24}
      .card,.timeline li{border-color:#1b2a24}
      .progress-bar{background:#1b2a24}
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family:system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;color:var(--ink);background:var(--bg)}
    .app-header{
      position:sticky; top:0; z-index:100;
      display:flex; justify-content:space-between; align-items:center; gap:8px;
      padding:14px 16px;
      background:linear-gradient(180deg, var(--card), color-mix(in oklab, var(--card) 70%, transparent));
      border-bottom:1px solid color-mix(in oklab, black 6%, transparent);
    }
    h1{margin:0; font-size:1.1rem}
    .muted{color:var(--muted)}
    .btn{background:none;border:1px solid color-mix(in oklab, black 8%, transparent); padding:8px 12px; border-radius:10px; color:var(--ink)}
    .btn.primary{background:var(--accent); border-color:var(--accent); color:#fff}
    .btn.ghost{border:none; color:var(--accent); font-weight:700; background:transparent}
    .btn:focus-visible{outline:2px solid color-mix(in oklab, var(--accent) 70%, white); outline-offset:2px}
    .view{display:none; padding:12px 12px calc(80px + var(--safe-bottom))}
    .view.active{display:block}
    .day-header{display:flex; justify-content:space-between; align-items:center; margin:8px 4px 12px}
    .day-cluster{display:flex; flex-direction:column; gap:4px}
    .day-name{font-size:1.1rem; font-weight:800; color:var(--accent)}
    .day-type{font-size:.92rem; color:var(--muted)}
    .streak{font-size:.9rem; color:var(--accent); font-weight:700}
    .picker{display:flex; gap:6px; flex-wrap:wrap}
    .chip{padding:6px 10px; border-radius:999px; border:1px solid color-mix(in oklab, black 8%, transparent); background:var(--card); font-size:.85rem; cursor:pointer}
    .chip[aria-pressed="true"]{background:var(--accent); color:#fff; border-color:var(--accent)}
    .timeline{list-style:none; padding:0; margin:0}
    .card, .timeline li{background:var(--card); border:1px solid color-mix(in oklab, black 8%, transparent); border-radius:14px; padding:14px; margin:10px 4px; box-shadow:var(--shadow)}
    .task{display:grid; grid-template-columns: 28px 1fr; align-items:start; gap:12px}
    .task input[type="checkbox"]{width:22px;height:22px; accent-color:var(--accent); margin-top:2px}
    .task label{display:block}
    .task-time{font-weight:800; color:var(--accent); font-size:.95rem; margin-bottom:2px}
    .task-title{font-weight:700; margin-bottom:2px}
    .task-note{color:var(--muted); font-size:.9rem; line-height:1.4}
    .task-details{margin-top:8px; padding-top:8px; border-top:1px solid color-mix(in oklab, black 10%, transparent)}
    .workout-details{background:color-mix(in oklab, var(--accent) 12%, transparent); padding:10px; border-radius:8px}
    .water{margin:18px 4px}
    .water-head{display:flex; justify-content:space-between; align-items:center; margin-bottom:8px}
    .drops{display:flex; gap:6px; flex-wrap:wrap}
    .drop{width:24px; height:32px; border-radius:12px; background:color-mix(in oklab, var(--accent) 15%, transparent); border:1px solid color-mix(in oklab, black 8%, transparent); cursor:pointer; position:relative; transition:transform .15s ease}
    .drop.filled{background:var(--drop); transform:scale(1.05)}
    .drop::after{content:""; position:absolute; top:6px; left:8px; width:8px; height:8px; border-radius:50%; background:rgba(255,255,255,.9)}
    .progress-bar{width:100%; height:8px; background:#dfe9e3; border-radius:6px; overflow:hidden; margin-top:6px}
    .progress-fill{height:100%; width:0; background:linear-gradient(90deg, var(--accent), var(--success)); transition:width .25s ease}
    @media (prefers-reduced-motion: reduce){ .drop{transition:none} .progress-fill{transition:none} }
    .stats-grid{display:grid; grid-template-columns:repeat(2,1fr); gap:12px; margin:10px 4px}
    .stat-card{text-align:center}
    .stat-number{font-size:1.4rem; font-weight:800; color:var(--accent)}
    .tabbar{
      position:fixed; inset-inline:0; bottom:0; z-index:101;
      display:flex; background:#fff; border-top:1px solid color-mix(in oklab, black 8%, transparent);
      padding-bottom:var(--safe-bottom);
    }
    @media (prefers-color-scheme: dark){ .tabbar{background:#0b100e} }
    .tabbar button{flex:1; padding:12px 8px; background:none; border:none; color:var(--muted); font-weight:700; font-size:.85rem}
    .tabbar button.active{color:var(--accent)}
    dialog{border:none; border-radius:14px; overflow:hidden}
    dialog form{padding:16px}
    #timeForm .row{display:grid; grid-template-columns: 1fr 120px; gap:8px; margin:6px 0}
    /* Resources layout */
    .resource-section{margin:12px 4px}
    .table{display:grid; gap:6px}
    .row{display:grid; grid-template-columns: 110px 1fr 90px 140px 1fr; gap:6px}
    .row div{background:var(--card); border:1px solid color-mix(in oklab, black 8%, transparent); border-radius:10px; padding:10px; text-align:center}
    .row.head div{font-weight:800}
    @media (max-width: 480px){
      .row{grid-template-columns: 90px 1fr; }
      .row div:nth-child(n+3){display:none}
    }
  .today-highlight{outline:2px solid color-mix(in oklab, var(--accent) 60%, white); border-radius:12px; box-shadow:0 0 0 4px color-mix(in oklab, var(--accent) 12%, transparent) inset}
    .today-chip{box-shadow:0 0 0 2px color-mix(in oklab, var(--accent) 50%, white)}
  </style>
</head>
<body>
  <header class="app-header" role="banner">
    <h1>Morning Fat Loss</h1>
    <div class="picker" role="tablist" aria-label="Pick a day to preview">
      <button class="chip" data-day="0" aria-pressed="false" aria-label="Sunday">Sun</button>
      <button class="chip" data-day="1" aria-pressed="false" aria-label="Monday">Mon</button>
      <button class="chip" data-day="2" aria-pressed="false" aria-label="Tuesday">Tue</button>
      <button class="chip" data-day="3" aria-pressed="false" aria-label="Wednesday">Wed</button>
      <button class="chip" data-day="4" aria-pressed="false" aria-label="Thursday">Thu</button>
      <button class="chip" data-day="5" aria-pressed="false" aria-label="Friday">Fri</button>
      <button class="chip" data-day="6" aria-pressed="false" aria-label="Saturday">Sat</button>
    </div>
  </header>

  <!-- Today View -->
  <main id="view-today" class="view active" role="main">
    <div class="day-header" aria-live="polite">
      <div class="day-cluster">
        <div class="day-name" id="dayName">Monday</div>
        <div class="day-type" id="dayType">Full Body Strength ‚Ä¢ Dose day</div>
        <div class="muted" id="weekLabel">Week 1</div>
      </div>
      <div class="streak" aria-label="Current streak"><span aria-hidden="true">üî•</span> <span id="streakCount">0</span> day streak</div>
    </div>

    <ul id="timeline" class="timeline" aria-label="Today timeline"></ul>

    <section class="water" aria-labelledby="waterHeading">
      <div class="water-head">
        <h2 id="waterHeading">Hydration</h2>
        <div class="muted"><span id="waterCurrent" aria-live="polite">0</span>/8 glasses</div>
      </div>
      <div id="waterDrops" class="drops" role="group" aria-label="Water cups"></div>
      <div class="progress-bar" aria-hidden="true"><div id="waterProgress" class="progress-fill"></div></div>
    </section>
  </main>

  <!-- Week View -->
  <main id="view-week" class="view">
    <div class="stats-grid" aria-label="Weekly stats">
      <div class="card stat-card"><div class="stat-number" id="weekCompleted">0</div><div class="muted">Days Completed</div></div>
      <div class="card stat-card"><div class="stat-number" id="weekPercentage">0%</div><div class="muted">Week Progress</div></div>
    </div>
    <div id="weekOverview" class="timeline"></div>
    <div class="card">
      <h2>Weekly Schedule</h2>
      <div id="weekSchedule"></div>
    </div>
    <button id="resetWeekBtn" class="btn" style="margin:12px 4px">Reset Week</button>
  </main>

  <!-- Resources -->
  <main id="view-resources" class="view">
    <section class="card resource-section">
      <h2>SECTION 1 ‚Äì 4-Week Morning Fat Loss Calendar</h2>
      <p>You‚Äôll have check boxes for: Dose ‚úî, Workout ‚úî, Cardio ‚úî, Nutrition ‚úî each day.</p>
      <p><strong>Legend:</strong> üèã Strength ‚Ä¢ ‚ö° HIIT ‚Ä¢ üö∂ Active Recovery ‚Ä¢ ‚ùå Rest</p>
      <div class="table">
        <div class="row head"><div>Day</div><div>Training</div><div>Sermorelin</div><div>Cardio</div><div>Nutrition Focus</div></div>
        <div class="row"><div>Mon üèã</div><div>Full Body Strength</div><div>‚úî</div><div>‚Äî</div><div>Mod carbs post‚Äëworkout</div></div>
        <div class="row"><div>Tue ‚ö°</div><div>HIIT + Core</div><div>‚úî</div><div>‚Äî</div><div>Low carb PM</div></div>
        <div class="row"><div>Wed üèã</div><div>Upper Strength + Cardio</div><div>‚úî</div><div>20 min steady</div><div>Mod carbs post‚Äëworkout</div></div>
        <div class="row"><div>Thu ‚ö°</div><div>HIIT</div><div>‚úî</div><div>‚Äî</div><div>Low carb PM</div></div>
        <div class="row"><div>Fri üèã</div><div>Lower Strength + Cardio</div><div>‚úî</div><div>20‚Äì30 min steady</div><div>Mod carbs post‚Äëworkout</div></div>
        <div class="row"><div>Sat üö∂</div><div>Active Recovery</div><div>‚ùå</div><div>Fasted walk</div><div>Low carb day</div></div>
        <div class="row"><div>Sun ‚ùå</div><div>Rest</div><div>‚ùå</div><div>Light walk optional</div><div>Low carb day</div></div>
      </div>
    </section>

    <section class="card resource-section">
      <h2>SECTION 2 ‚Äì Detailed Workouts (With Alternatives)</h2>
      <h3>MONDAY ‚Äì Full Body Strength</h3>
      <p><em>Main Routine (3 sets each, 8‚Äì12 reps, 60‚Äì90 sec rest)</em></p>
      <ul>
        <li>Barbell Back Squat ‚Üí alt: Dumbbell Goblet Squat</li>
        <li>Bench Press ‚Üí alt: Dumbbell Chest Press</li>
        <li>Bent-Over Barbell Row ‚Üí alt: One-Arm Dumbbell Row</li>
        <li>Seated Overhead Press ‚Üí alt: Arnold Press</li>
        <li>Romanian Deadlift ‚Üí alt: Kettlebell Deadlift</li>
        <li>Plank (3√ó30‚Äì60 sec) ‚Üí alt: Dead Bug</li>
      </ul>

      <h3>TUESDAY ‚Äì HIIT + Core</h3>
      <p><em>HIIT (15‚Äì20 min)</em></p>
      <ul>
        <li>20 sec all-out sprint (bike/treadmill/rower) ‚Üí 40 sec rest √ó 8‚Äì10</li>
      </ul>
      <p><em>Core Finisher (3 rounds)</em></p>
      <ul>
        <li>Hanging Knee Raises √ó 12 ‚Üí alt: Lying Leg Raise</li>
        <li>Russian Twists √ó 20 (10/side) ‚Üí alt: Cable Woodchop</li>
        <li>Side Plank √ó 30 sec/side</li>
      </ul>

      <h3>WEDNESDAY ‚Äì Upper Strength + Cardio</h3>
      <p><em>Strength (3√ó8‚Äì12)</em></p>
      <ul>
        <li>Pull-Ups or Assisted Pull-Up ‚Üí alt: Lat Pulldown</li>
        <li>Incline Dumbbell Press ‚Üí alt: Barbell Incline Press</li>
        <li>Barbell Row ‚Üí alt: Single-Arm Row</li>
        <li>Dumbbell Lateral Raise ‚Üí alt: Cable Lateral Raise</li>
        <li>Tricep Dips ‚Üí alt: Cable Rope Pushdown</li>
        <li>Bicep Curl ‚Üí alt: Hammer Curl</li>
      </ul>
      <p><em>Cardio ‚Äì 20 min steady pace after lifting</em></p>

      <h3>THURSDAY ‚Äì HIIT</h3>
      <ul>
        <li>30 sec high-intensity battle ropes ‚Üí 30 sec rest √ó 10 rounds</li>
        <li><strong>or</strong> Sprint Intervals: 15 sec all-out / 45 sec walk √ó 10 rounds</li>
      </ul>

      <h3>FRIDAY ‚Äì Lower Strength + Cardio</h3>
      <p><em>Strength (3√ó8‚Äì12)</em></p>
      <ul>
        <li>Deadlift ‚Üí alt: Trap Bar Deadlift</li>
        <li>Walking Lunges (per leg) ‚Üí alt: Step-Ups</li>
        <li>Hip Thrusts ‚Üí alt: Glute Bridge</li>
        <li>Bulgarian Split Squat ‚Üí alt: Goblet Squat</li>
        <li>Standing Calf Raise ‚Üí alt: Seated Calf Raise</li>
      </ul>
      <p><em>Cardio ‚Äì 20‚Äì30 min steady pace after lifting</em></p>

      <h3>SATURDAY ‚Äì Active Recovery</h3>
      <ul>
        <li>20‚Äì30 min fasted walk or yoga/stretching</li>
        <li>Focus on mobility and recovery</li>
      </ul>
    </section>

    <section class="card resource-section">
      <h2>SECTION 3 ‚Äì Nutrition & Snack Options</h2>
      <h3>Protein Snack Options</h3>
      <ul>
        <li>Whey isolate (110‚Äì130 cal, 25g protein) with water or unsweetened almond milk</li>
        <li>Greek yogurt (150g, 100 cal, 18g protein) + cinnamon</li>
        <li>Cottage cheese (¬Ω cup, 90 cal, 14g protein) with berries</li>
        <li>Turkey or chicken slices with mustard</li>
        <li>Hard-boiled eggs (add hot sauce or spices)</li>
        <li>Protein bars (aim for 18‚Äì22g protein, &lt;8g sugar)</li>
      </ul>

      <h3>Breakfast Ideas (post‚Äëworkout small carbs)</h3>
      <ul>
        <li>2 eggs + 3 egg whites + ¬Ω banana</li>
        <li>Protein shake + small handful of berries</li>
        <li>Greek yogurt + chia seeds + blueberries</li>
      </ul>

      <h3>Lunch Ideas (moderate carbs)</h3>
      <ul>
        <li>Chicken breast + quinoa + roasted veggies</li>
        <li>Salmon + sweet potato + spinach</li>
        <li>Lean ground turkey + brown rice + broccoli</li>
      </ul>

      <h3>Dinner Ideas (low carb, protein + fats)</h3>
      <ul>
        <li>Grilled chicken + asparagus + olive oil</li>
        <li>White fish + zucchini noodles + pesto</li>
        <li>Lean steak + roasted Brussels sprouts</li>
      </ul>
    </section>
  </main>

  <nav class="tabbar" role="navigation" aria-label="App tabs">
    <button data-target="view-today" class="active" aria-controls="view-today" aria-selected="true">Today</button>
    <button data-target="view-week" aria-controls="view-week" aria-selected="false">Week</button>
    <button data-target="view-resources" aria-controls="view-resources" aria-selected="false">Resources</button>
  </nav>

  <dialog id="timeEditor">
    <form method="dialog">
      <h3>Edit Times</h3>
      <div id="timeForm"></div>
      <menu>
        <button value="cancel" class="btn">Cancel</button>
        <button value="save" class="btn primary">Save</button>
      </menu>
    </form>
  </dialog>

  <script>
    // ---- Data (Mon‚ÄìFri dose days; Sat/Sun no dose) ----
    const WEEKLY_SCHEDULE = {
      0:{type:"Rest Day",workoutType:"rest",dose:false,schedule:[
        {key:"hydrate",time:"08:00",title:"Wake & Hydrate",note:"16‚Äì20 oz water"},
        {key:"activity",time:"09:00",title:"Light Activity",note:"Light mobility or leisure activity"},
        {key:"breakfast",time:"09:30",title:"Breakfast",note:"Protein + fats"},
        {key:"lunch",time:"12:30",title:"Lunch",note:"Protein + greens (low carb)"},
        {key:"dinner",time:"18:00",title:"Dinner",note:"Protein + veggies (low carb)"},
        {key:"sleep",time:"22:00",title:"Wind Down",note:"No food 2 hrs before bed"}
      ]},
      1:{type:"Full Body Strength",workoutType:"strength",dose:true,schedule:[
        {key:"hydrate",time:"06:15",title:"Wake & Hydrate",note:"16‚Äì20 oz water"},
        {key:"workout",time:"06:30",title:"Full Body Workout",note:"45‚Äì60 min strength",details:"Barbell Back Squat ‚Üí alt: Goblet Squat; Bench Press ‚Üí alt: DB Chest; Bent‚ÄëOver Row ‚Üí alt: 1‚ÄëArm DB Row; Seated OHP ‚Üí alt: Arnold Press; RDL ‚Üí alt: Kettlebell Deadlift; Plank 3√ó30‚Äì60s ‚Üí alt: Dead Bug"},
        {key:"postwo",time:"07:45",title:"Post‚ÄëWorkout",note:"25‚Äì30g protein + small carbs (banana/berries)"},
        {key:"snack1",time:"10:30",title:"Snack",note:"Protein + fats (turkey + avocado)"},
        {key:"lunch",time:"13:00",title:"Lunch",note:"Lean protein + moderate carbs + veggies"},
        {key:"snack2",time:"16:30",title:"Snack",note:"Protein + veggies or nuts"},
        {key:"dinner",time:"19:00",title:"Dinner",note:"Protein + low‚Äëcarb veggies + healthy fats"},
        {key:"cutoff",time:"21:45",title:"Food Cutoff",note:"No food after this time"},
        {key:"dose",time:"22:30",title:"Sermorelin 40 mg",note:""},
        {key:"sleep",time:"22:35",title:"Sleep",note:""}
      ]},
      2:{type:"HIIT + Core",workoutType:"hiit",dose:true,schedule:[
        {key:"hydrate",time:"06:15",title:"Wake & Hydrate",note:"16‚Äì20 oz water"},
        {key:"workout",time:"06:30",title:"HIIT + Core",note:"15‚Äì20 min HIIT + core",details:"Sprints 20s all‚Äëout / 40s rest √ó 8‚Äì10 ‚Ä¢ Core: Knee Raises √ó12, Russian Twists √ó20, Side Plank √ó30s/side"},
        {key:"postwo",time:"06:55",title:"Post‚ÄëWorkout",note:"Protein + small carbs"},
        {key:"snack1",time:"10:00",title:"Snack",note:"Protein + fats"},
        {key:"lunch",time:"13:00",title:"Lunch",note:"Lean protein + moderate carbs"},
        {key:"snack2",time:"16:00",title:"Snack",note:"Protein + veggies"},
        {key:"dinner",time:"19:00",title:"Dinner",note:"Protein + greens + olive oil"},
        {key:"cutoff",time:"21:45",title:"Food Cutoff",note:"No food after this time"},
        {key:"dose",time:"22:30",title:"Sermorelin 40 mg",note:""}
      ]},
      3:{type:"Upper Strength + Cardio",workoutType:"strength",dose:true,schedule:[
        {key:"hydrate",time:"06:15",title:"Wake & Hydrate",note:"16‚Äì20 oz water"},
        {key:"workout",time:"06:30",title:"Upper + 20m Cardio",note:"45 min upper + 20 min steady",details:"Pull‚ÄëUps ‚Üí alt: Lat Pulldown; Incline DB Press ‚Üí alt: Barbell Incline; Barbell Row ‚Üí alt: Single‚ÄëArm Row; DB Laterals ‚Üí alt: Cable Laterals; Dips ‚Üí alt: Rope Pushdown; Curls ‚Üí alt: Hammer Curl"},
        {key:"postwo",time:"07:45",title:"Post‚ÄëWorkout",note:"Protein + moderate carbs"},
        {key:"snack1",time:"10:30",title:"Snack",note:"Protein + fats"},
        {key:"lunch",time:"13:00",title:"Lunch",note:"Lean protein + moderate carbs"},
        {key:"snack2",time:"16:30",title:"Snack",note:"Protein + veggies"},
        {key:"dinner",time:"19:00",title:"Dinner",note:"Protein + low‚Äëcarb veggies + fats"},
        {key:"cutoff",time:"21:45",title:"Food Cutoff",note:"No food after this time"},
        {key:"dose",time:"22:30",title:"Sermorelin 40 mg",note:""}
      ]},
      4:{type:"HIIT",workoutType:"hiit",dose:true,schedule:[
        {key:"hydrate",time:"06:15",title:"Wake & Hydrate",note:"16‚Äì20 oz water"},
        {key:"workout",time:"06:30",title:"HIIT Training",note:"15 min high intensity",details:"Battle ropes 30s on / 30s off √ó 10 or Sprints 15s all‚Äëout / 45s walk √ó 10"},
        {key:"postwo",time:"06:50",title:"Post‚ÄëWorkout",note:"Protein + small carbs"},
        {key:"snack1",time:"10:00",title:"Snack",note:"Protein + fats"},
        {key:"lunch",time:"13:00",title:"Lunch",note:"Lean protein + moderate carbs"},
        {key:"snack2",time:"16:00",title:"Snack",note:"Protein + veggies"},
        {key:"dinner",time:"19:00",title:"Dinner",note:"Protein + greens + olive oil"},
        {key:"cutoff",time:"21:45",title:"Food Cutoff",note:"No food after this time"},
        {key:"dose",time:"22:30",title:"Sermorelin 40 mg",note:""}
      ]},
      5:{type:"Lower Strength + Cardio",workoutType:"strength",dose:true,schedule:[
        {key:"hydrate",time:"06:15",title:"Wake & Hydrate",note:"16‚Äì20 oz water"},
        {key:"workout",time:"06:30",title:"Lower + 20‚Äì30m Cardio",note:"45 min lower + 20‚Äì30 min steady",details:"Deadlift ‚Üí alt: Trap Bar; Walking Lunges ‚Üí alt: Step‚ÄëUps; Hip Thrust ‚Üí alt: Glute Bridge; Bulgarian Split Squat ‚Üí alt: Goblet Squat; Standing Calf Raise ‚Üí alt: Seated Calf Raise"},
        {key:"postwo",time:"07:45",title:"Post‚ÄëWorkout",note:"Protein + moderate carbs"},
        {key:"snack1",time:"10:30",title:"Snack",note:"Protein + fats"},
        {key:"lunch",time:"13:00",title:"Lunch",note:"Lean protein + moderate carbs"},
        {key:"snack2",time:"16:30",title:"Snack",note:"Protein + veggies"},
        {key:"dinner",time:"19:00",title:"Dinner",note:"Protein + low‚Äëcarb veggies + fats"},
        {key:"cutoff",time:"21:45",title:"Food Cutoff",note:"No food after this time"},
        {key:"dose",time:"22:30",title:"Sermorelin 40 mg",note:""}
      ]},
      6:{type:"Active Recovery",workoutType:"recovery",dose:false,schedule:[
        {key:"hydrate",time:"07:00",title:"Wake & Hydrate",note:"16‚Äì20 oz water"},
        {key:"activity",time:"07:30",title:"Fasted Walk / Yoga",note:"20‚Äì30 min light activity"},
        {key:"breakfast",time:"09:00",title:"Breakfast",note:"Protein + fats (low carb)"},
        {key:"lunch",time:"12:30",title:"Lunch",note:"Protein + greens (low carb)"},
        {key:"dinner",time:"18:00",title:"Dinner",note:"Protein + veggies (low carb)"},
        {key:"sleep",time:"22:00",title:"Wind Down",note:"No food 2 hrs before bed"}
      ]}
    };
    const ICONS={strength:"üèãÔ∏è",hiit:"‚ö°",recovery:"üö∂",rest:"üò¥"};
    const DAY_NAMES=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];

    // ---- State helpers ----
    function loadState(){ try{return JSON.parse(localStorage.getItem("mfl_state_v21")||"{}")}catch(e){return {}}}
    function saveState(s){ localStorage.setItem("mfl_state_v21", JSON.stringify(s)) }
    function todayKey(){ return new Date().toISOString().slice(0,10) }
    function getDow(){ return Number(document.querySelector('.chip[aria-pressed="true"]')?.dataset.day ?? new Date().getDay()) }
    function toHuman(hm){ if(!hm||hm.includes(':')===false) return hm; const [h,m]=hm.split(':').map(Number); const d=new Date(); d.setHours(h); d.setMinutes(m); return d.toLocaleTimeString([], {hour:'numeric',minute:'2-digit'}) }

    function initDefaults(){
      const s=loadState();
      if(!s.waterGoal) s.waterGoal=8;
      if(!s.water) s.water={};
      if(!s.checks) s.checks={}; // dateKey -> { itemKey: true }
      if(!s.streak) s.streak=0;
      if(!s.weekStart){
        const t=new Date(); const mon=new Date(t);
        const dow=mon.getDay(); const diff=(dow===0?-6:1)-dow; mon.setDate(t.getDate()+diff);
        s.weekStart=mon.toISOString().slice(0,10);
      }
      saveState(s);
    }

    // ---- Rendering ----
    function renderHeader(){
      const dow=getDow();
      const meta=WEEKLY_SCHEDULE[dow];
      document.getElementById('dayName').textContent=DAY_NAMES[dow];
      document.getElementById('dayType').textContent = `${ICONS[meta.workoutType]} ${meta.type} ‚Ä¢ ${meta.dose ? 'Dose day' : 'No dose'}`;
      const s=loadState(); document.getElementById('streakCount').textContent = s.streak||0;
      // Week label
      const start=new Date(s.weekStart); const diffDays = Math.floor((Date.now()-start.getTime())/86400000);
      const weekNum = Math.floor(diffDays/7)+1;
      document.getElementById('weekLabel').textContent = `Week ${Math.max(1, weekNum)}`;
    }

    function renderTimeline(){
      const timeline=document.getElementById('timeline'); timeline.innerHTML='';
      const s=loadState(); const dk=todayKey(); const checks=s.checks[dk]||{};
      const dow=getDow(); const plan=WEEKLY_SCHEDULE[dow].schedule;

      plan.forEach(item=>{
        const li=document.createElement('li');
        const div=document.createElement('div'); div.className='task';
        const id=`${dow}-${item.key}`;
        const cb=document.createElement('input'); cb.type='checkbox'; cb.id=id; cb.checked=!!checks[id];
        cb.addEventListener('change',()=>{
          const st=loadState(); st.checks[dk]=st.checks[dk]||{}; st.checks[dk][id]=cb.checked; saveState(st); updateProgress(); renderWeek();
        });
        const lbl=document.createElement('label'); lbl.setAttribute('for', id);
        lbl.innerHTML = `<div class="task-time">${toHuman(item.time)}</div>
                         <div class="task-title">${item.title}</div>
                         <div class="task-note">${item.note||''}</div>
                         ${item.details?`<div class="task-details"><div class="workout-details"><strong>Workout Details:</strong><br>${item.details}</div></div>`:''}`;
        div.append(cb,lbl); li.append(div); timeline.append(li);
      });
    }

    function renderWater(){
      const s=loadState(); const dk=todayKey(); const cur=s.water[dk]||0;
      document.getElementById('waterCurrent').textContent=cur;
      const wrap=document.getElementById('waterDrops'); wrap.innerHTML='';
      for(let i=0;i<s.waterGoal;i++){
        const b=document.createElement('button'); b.type='button'; b.className='drop'+(i<cur?' filled':'');
        b.addEventListener('click',()=>{
          const st=loadState(); const c=st.water[dk]||0; st.water[dk]=(i<c)?i:i+1; saveState(st); renderWater(); updateProgress();
        });
        wrap.append(b);
      }
      document.getElementById('waterProgress').style.width = ((cur/s.waterGoal)*100).toFixed(0)+'%';
    }

    function renderWeek(){
      const s=loadState();
      const weekOverview=document.getElementById('weekOverview'); weekOverview.innerHTML='';
      const weekSchedule=document.getElementById('weekSchedule'); weekSchedule.innerHTML='';

      const start=new Date(s.weekStart);
      let doneDays=0;
      for(let i=0;i<7;i++){
        const d=new Date(start); d.setDate(start.getDate()+i);
        const dateKey=d.toISOString().slice(0,10); const dow=d.getDay();
        const plan=WEEKLY_SCHEDULE[dow]; const checks=s.checks[dateKey]||{};
        const completed=Object.values(checks).filter(Boolean).length;
        const total=plan.schedule.length; const water=(s.water[dateKey]||0)/(s.waterGoal||8);
        const pct = Math.min(1, (total?completed/total:0)*0.8 + water*0.2);

        const row=document.createElement('li'); row.className='card';
        if(new Date().toDateString()===d.toDateString()){ row.classList.add('today-highlight'); }
        row.innerHTML = `<div style="display:flex;justify-content:space-between;align-items:center;gap:8px">
          <div><strong>${DAY_NAMES[dow]}</strong> ‚Ä¢ ${ICONS[plan.workoutType]} ${plan.type} ‚Ä¢ ${plan.dose?'Dose':'No dose'}</div>
          <div style="min-width:46px;text-align:right"><strong>${Math.round(pct*100)}%</strong></div>
        </div>
        <div class="progress-bar"><div class="progress-fill" style="width:${(pct*100).toFixed(0)}%"></div></div>`;
        weekOverview.append(row);

        const sched=document.createElement('div'); sched.className='card';
        if(new Date().toDateString()===d.toDateString()){ sched.classList.add('today-highlight'); } sched.innerHTML=`<h3 style="margin:0 0 6px">${DAY_NAMES[dow]} ‚Äì ${plan.type}</h3>`;
        plan.schedule.forEach(item=>{
          const line=document.createElement('div'); line.className='muted'; line.style.margin='2px 0';
          line.textContent = `${toHuman(item.time)} ‚Ä¢ ${item.title}`;
          sched.append(line);
        });
        weekSchedule.append(sched);
        if(pct>=0.9) doneDays++;
      }
      const pctWeek = Math.round((doneDays/7)*100);
      document.getElementById('weekCompleted').textContent=doneDays;
      document.getElementById('weekPercentage').textContent=pctWeek+'%';
    }

    function updateProgress(){
      const s=loadState(); const dk=todayKey();
      const dow=getDow(); const plan=WEEKLY_SCHEDULE[dow];
      const checks=s.checks[dk]||{}; const completed=Object.values(checks).filter(Boolean).length;
      const total=plan.schedule.length; const water=(s.water[dk]||0)/(s.waterGoal||8);
      const pct=Math.min(1, (total?completed/total:0)*0.8 + water*0.2);
      if(pct>=0.9 && !s._markedToday){
        s._markedToday=true; s.streak=(s.streak||0)+1; saveState(s);
        document.getElementById('streakCount').textContent=s.streak;
      }
    }

    // Midnight refresh
    function scheduleMidnight(){
      const now=new Date(); const tomorrow=new Date(now);
      tomorrow.setDate(now.getDate()+1); tomorrow.setHours(0,0,0,0);
      setTimeout(()=>{ renderAll(); renderWeek(); scheduleMidnight(); }, tomorrow.getTime()-now.getTime());
    }

    // Navigation (class-based)
    document.querySelectorAll('.tabbar button').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        // switch active tab
        document.querySelectorAll('.tabbar button').forEach(b=>b.classList.remove('active'));
        btn.classList.add('active');
        // switch active view
        document.querySelectorAll('.view').forEach(v=>v.classList.remove('active'));
        const target = document.getElementById(btn.dataset.target);
        if(target){ target.classList.add('active'); }
        // scroll to top for better context
        window.scrollTo({top:0, behavior:'smooth'});
        if(btn.dataset.target==='view-week'){ renderWeek(); }
      });
    });

    // Weekday picker
    document.querySelectorAll('.chip').forEach(chip=>{
      chip.addEventListener('click', ()=>{
        document.querySelectorAll('.chip').forEach(c=>c.setAttribute('aria-pressed','false'));
        chip.setAttribute('aria-pressed','true');
        renderAll();
      });
    });

    function setPickerToToday(){
      // add subtle ring on today's chip
      const dow=new Date().getDay();
      const chip=document.querySelector(`.chip[data-day="${dow}"]`);
      if(chip){ chip.setAttribute('aria-pressed','true'); chip.classList.add('today-chip'); }
    }

    function renderAll(){
      renderHeader();
      renderTimeline();
      renderWater();
      updateProgress();
    }

    // Init
    initDefaults();
    setPickerToToday();
    renderAll();
    renderWeek();
    scheduleMidnight();

    // PWA
    if('serviceWorker' in navigator){
      navigator.serviceWorker.register('./service-worker.js').catch(()=>{});
    }
  </script>
</body>
</html>
